# 実装計画

- [x] 1. フロントエンド実装（モックデータ）
  - Nuxt 3 + Vue 3 + TypeScriptで注文ページを実装
  - モックデータを使用してバックエンド接続なしで動作確認
  - 既存のデザインシステムとコンポーネントパターンに準拠
  - _要件: 1, 2, 3, 4, 5, 6, 7, 9_

- [x] 1.1 Composablesの実装
  - usePriceRounding: 価格の丸め処理と割引計算
  - useOrderForm: 注文フォームのロジック（増減、検証）
  - useOrderData: 注文ページのデータ取得と状態管理（モック版）
  - _要件: 5.1, 5.5, 5.6, 6.1, 6.2, 6.3, 7.2, 8.1_

- [x] 1.2 usePriceRoundingのプロパティテスト
  - **プロパティ4: 価格丸め処理の正確性**
  - **検証: 要件 5.1**

- [x] 1.3 useOrderFormのプロパティテスト
  - **プロパティ5: 数量増減の正確性**
  - **プロパティ6: 割引価格計算の正確性**
  - **プロパティ7: 推定合計の計算正確性**
  - **検証: 要件 5.5, 5.6, 5.7, 6.1, 6.2, 6.3, 7.2**

- [x] 1.4 基本コンポーネントの実装
  - OrderHeader: 通貨ペア選択タブ
  - PriceDisplay: 現在価格と変動率表示
  - TimeFilterButtons: 時間範囲フィルターボタン
  - _要件: 1.1, 1.2, 1.3, 2.1, 2.2, 2.3, 3.1, 3.2, 3.3_

- [x] 1.5 基本コンポーネントのユニットテスト
  - OrderHeaderのタブ切り替えテスト
  - PriceDisplayの価格フォーマットテスト
  - TimeFilterButtonsのフィルター選択テスト
  - _要件: 1.1, 1.2, 1.3, 2.1, 2.2, 2.3, 3.1, 3.2, 3.3_

- [x] 1.6 注文フォームコンポーネントの実装
  - PriceInput: 価格入力フィールドと割引ボタン
  - AmountInput: 数量入力フィールドと増減ボタン
  - OrderForm: 注文フォーム全体の統合
  - _要件: 4.1, 4.2, 5.1, 5.2, 5.3, 5.4, 5.5, 5.6, 6.1, 6.2, 6.3, 7.1, 7.2, 7.3, 8.1_

- [x] 1.7 注文フォームコンポーネントのユニットテスト
  - PriceInputの入力と割引ボタンテスト
  - AmountInputの入力と増減ボタンテスト
  - OrderFormの統合テスト
  - _要件: 5.1, 5.2, 5.3, 5.4, 5.5, 5.6, 6.1, 6.2, 6.3, 7.2, 8.1_

- [x] 1.8 メインページの実装
  - pages/order.vue: 全体のレイアウトと状態管理
  - 既存のPriceChartコンポーネントとNavigationBarコンポーネントを統合
  - モックデータを使用した動作確認
  - _要件: 1, 2, 3, 4, 5, 6, 7, 8, 9_

- [x] 1.9 メインページのプロパティテスト
  - **プロパティ1: 通貨ペア選択の一貫性**
  - **プロパティ8: 残高超過時の注文防止**
  - **プロパティ9: 入力検証の完全性**
  - **検証: 要件 1.2, 7.3, 8.1, 8.5**

- [x] 1.10 スタイリングとレスポンシブ対応
  - Figmaデザインに基づいたスタイリング
  - モバイル、タブレット、デスクトップ対応
  - アクセシビリティ対応（タッチターゲット、コントラスト比）
  - _要件: 9.1, 9.2, 9.3_

- [x] 1.11 チェックポイント - フロントエンドの動作確認
  - すべてのテストが通過することを確認（146テスト合格）
  - TypeScriptエラーなし
  - レスポンシブデザインとアクセシビリティ対応完了

- [x] 2. API設計とOpenAPI仕様書の作成
  - 注文作成、残高取得のエンドポイント定義
  - リクエスト/レスポンスモデルの定義
  - エラーレスポンスの定義
  - _要件: 7.1, 8.2, 8.3, 8.4_

- [x] 2.1 OpenAPI仕様書の作成
  - openapi.yamlに注文関連のエンドポイントを追加
  - POST /api/v1/orders: 注文作成
  - GET /api/v1/balance: 残高取得
  - スキーマ定義（Order, Balance, CreateOrderRequest, ErrorResponse）
  - _要件: 7.1, 8.2, 8.3, 8.4_

- [x] 2.2 OpenAPI仕様書のレビュー
  - 仕様書の妥当性確認
  - エンドポイントとモデルの整合性確認

- [ ] 3. コード生成
  - OpenAPI仕様書からGoの型定義を生成
  - フロントエンドの型定義を更新
  - _要件: 8.2_

- [-] 3.1 バックエンドのコード生成
  - oapi-codegenを使用してGoの型定義を生成
  - internal/generated/models.goを更新
  - _要件: 8.2_

- [ ] 3.2 フロントエンドの型定義更新
  - openapi-typescriptを使用して型定義を生成
  - types/api.tsを更新
  - _要件: 8.2_

- [ ] 4. バックエンド実装
  - データベーススキーマの作成
  - Repository、Service、Handler層の実装
  - ビジネスロジックとバリデーションの実装
  - _要件: 7.1, 7.3, 8.1, 8.2, 8.3, 8.4, 8.5_

- [ ] 4.1 データベーススキーマの作成
  - ordersテーブルのマイグレーション作成
  - balancesテーブルのマイグレーション作成
  - インデックスと外部キー制約の設定
  - _要件: 8.2_

- [ ] 4.2 Repository層の実装
  - OrderRepository: 注文のCRUD操作
  - BalanceRepository: 残高の取得と更新
  - トランザクション処理の実装
  - _要件: 7.1, 8.2_

- [ ]* 4.3 Repository層のユニットテスト
  - OrderRepositoryのCRUD操作テスト
  - BalanceRepositoryの取得と更新テスト
  - トランザクション処理のテスト
  - _要件: 7.1, 8.2_

- [ ] 4.4 Service層の実装
  - OrderService: 注文作成のビジネスロジック
  - 注文バリデーション（価格、数量、残高チェック）
  - 推定合計の計算
  - 残高更新のトランザクション処理
  - _要件: 7.2, 7.3, 8.1, 8.2_

- [ ]* 4.5 Service層のユニットテスト
  - 注文作成の正常系テスト
  - バリデーションエラーのテスト（価格、数量、残高）
  - 推定合計計算のテスト
  - トランザクション処理のテスト
  - _要件: 7.2, 7.3, 8.1, 8.5_

- [ ] 4.6 Handler層の実装
  - OrderHandler: POST /api/v1/orders
  - BalanceHandler: GET /api/v1/balance
  - エラーハンドリングとレスポンス生成
  - _要件: 8.2, 8.3, 8.4_

- [ ]* 4.7 Handler層のユニットテスト
  - 注文作成エンドポイントのテスト
  - 残高取得エンドポイントのテスト
  - エラーレスポンスのテスト
  - _要件: 8.2, 8.3, 8.4_

- [ ] 4.8 ルーティングの設定
  - cmd/server/main.goにルートを追加
  - ミドルウェアの設定（認証、レート制限）
  - _要件: 8.2_

- [ ] 4.9 チェックポイント - バックエンドの動作確認
  - すべてのテストが通過することを確認
  - APIエンドポイントの手動テスト
  - ユーザーが質問がある場合は尋ねる

- [ ] 5. フロントエンドとバックエンドの統合
  - モックデータをAPI呼び出しに置き換え
  - エラーハンドリングの実装
  - ローディング状態の実装
  - _要件: 8.2, 8.3, 8.4_

- [ ] 5.1 useOrderDataの実装（API版）
  - fetchPriceData: 価格データをAPIから取得
  - fetchChartData: チャートデータをAPIから取得
  - fetchBalance: 残高をAPIから取得
  - submitOrder: 注文をAPIに送信
  - _要件: 7.1, 8.2, 8.3, 8.4_

- [ ] 5.2 OrderFormの統合
  - API呼び出しの統合
  - エラーハンドリングの実装
  - 成功/失敗メッセージの表示
  - _要件: 8.2, 8.3, 8.4_

- [ ] 5.3 エラーハンドリングの改善
  - ネットワークエラーの処理
  - APIエラーレスポンスの処理
  - ユーザーフレンドリーなエラーメッセージ
  - _要件: 8.4_

- [ ]* 5.4 E2Eテストの実装
  - ページ読み込みとデフォルト値の確認
  - 通貨ペア切り替えと価格更新の確認
  - 注文フォームの入力と送信
  - エラーケースのテスト
  - _要件: 1, 2, 3, 4, 5, 6, 7, 8_

- [ ] 5.5 最終チェックポイント
  - すべてのテストが通過することを確認
  - 実際のユーザーフローを手動でテスト
  - パフォーマンスとアクセシビリティの確認
  - ユーザーが質問がある場合は尋ねる
